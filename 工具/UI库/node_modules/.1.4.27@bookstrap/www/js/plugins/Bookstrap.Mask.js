/*global bookstrap: false */
define(['underscore', 'lib/events'], function(_, EventEmitter) {
    var MaskPlugin = function(opts) {
      _.extend(this, {
        'customClass': '',
        'parent': 'body'
      }, opts);

      this.closeEvent = bookstrap.hasTouchSupport ? 'tap' : 'click';
      this.$el = null;
    };

    MaskPlugin.prototype = new EventEmitter();

    MaskPlugin.prototype.addCloseEvent = function(events) {
      this.closeEvent = [this.closeEvent, events].join(' ');
    }

    MaskPlugin.prototype.show = function() {
      var self = this;

      if (!this.$el) {
        this.$el = $('<div>');
        this.$el.addClass(['book-overlay-mask', this.customClass].join(' '));
        this.$el.appendTo(this.parent);
      }

      this.$el.hammer().on(this.closeEvent, _.bind(this.onClose, this));

      this.$el.show();
      this.emit('show');
    };

    MaskPlugin.prototype.onClose = function() {
      this.hide();
    };

    MaskPlugin.prototype.hide = function() {
      if (this.$el) {
        this.$el.hide();
        this.$el.hammer().off(this.closeEvent);
      }

      this.emit('hide');
    };

    return MaskPlugin;
});
