/*global bookstrap: true, bookstrapConfig: false, require: false */

require.config({
  baseUrl: "js/",
  paths: {
    underscore: 'lib/underscore.amd',
    imagesloaded: 'lib/imagesloaded.pkgd.min',
    text: 'lib/text'
  }
});

require([
  'Bookstrap.Core',
  'lib/jquery.hammer'
  ], function(Bookstrap, Hammer) {

    $(function() {

      var config = typeof(bookstrapConfig) === 'undefined' ? {} : bookstrapConfig;
      window.bookstrap = new Bookstrap(config);
      // Increase the default from 11, since we set-up a lot of listeners by default
      window.bookstrap.setMaxListeners(25);

      var plugins = [];
      $('plugin').each(function() {
        plugins.push('plugins/' + this.attributes.name.value);
      });

      require(plugins, function loadPlugins() {
        var args = _.toArray(arguments);
        args.forEach(function(BookstrapPlugin) {
          new BookstrapPlugin(window.bookstrap);
        });
        window.bookstrap.init();
      });
    });
});